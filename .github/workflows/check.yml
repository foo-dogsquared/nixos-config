name: "Check flake outputs"
on:
  pull_request:
  push:
    branches:
      - master
      - develop
  schedule:
    - cron: '5 10 * * 4' # At 10:05 on Thursday.
jobs:
  check-outputs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: DeterminateSystems/nix-installer-action@v4
      - name: Check flake lockfile
        uses: DeterminateSystems/flake-checker-action@v5
      - name: Check flake outputs
        run: |
          nix flake check --impure --no-build --accept-flake-config
        env:
          NIXPKGS_ALLOW_BROKEN: "1"
          NIXPKGS_ALLOW_UNFREE: "1"
          NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM: "1"
